# Falcor中的比例尺和相机移动速度

## 比例尺

Falcor中的比例尺是使用真实世界的物理单位，即米（meters）。这在整个引擎中保持一致，用于场景元素、相机设置和物理计算。 Scene.cpp:2364-2366

## 相机的默认移动速度

Falcor中相机的默认移动速度设置如下：

1. 相机速度的基本默认值是1.0米/秒。这是在Scene对象初始化时设置的值。 Scene.h:1339-1340
2. 然而，在实际应用中，相机速度通常会根据场景的大小进行调整。默认的做法是将相机速度设置为场景半径的25%（即0.25倍的场景半径），这样可以根据场景的不同大小提供合适的移动速度。 HelloDXR.cpp:132-133
3. 用户可以通过键盘快捷键动态调整相机移动速度：
   1. 按住Shift键可以增加移动速度
   2. 按住Ctrl键可以减少移动速度 scenes.md:40-42

## 总结

Falcor中使用的比例尺是基于真实世界的物理单位（米），相机的默认移动速度是场景半径的25%，单位是米/秒。这种设计允许相机速度自动适应不同大小的场景，使用户在任何场景中都能获得合理的导航体验。

## 注意

相机的移动速度可以通过 `Scene::setCameraSpeed()`方法进行设置，并且会被限制在有效范围内（大于等于0）。 Scene.cpp:2370-2373

# 在Falcor中，虚拟相机的感光平面的面积

在Falcor中，虚拟相机确实有一个具有定义面积的感光平面（sensor plane）。

感光平面的定义和计算可以在Camera.cpp文件中找到。相机的感光平面是由两个向量cameraU和cameraV定义的，这两个向量分别表示感光平面的宽度和高度方向。 Camera.cpp:173-181

这些向量根据相机的以下参数进行计算：

* 焦距（focal distance）
* 视场角（field of view）
* 宽高比（aspect ratio）

感光平面的面积计算方式为：

```Plain
面积 = ulen * vlen = (focalDistance * tan(fovY/2) * aspectRatio) * (focalDistance * tan(fovY/2))     = focalDistance² * tan(fovY/2)² * aspectRatio  
```

我们可以从不同的导入器实现中看到，Falcor支持设置帧高度（frameHeight）或帧宽度（frameWidth），这直接影响感光平面的尺寸。 ImporterContext.cpp:1631-1640

在相机设置过程中，如果指定了帧宽度，则会根据宽高比计算帧高度；反之，如果指定了帧高度，则会计算相应的帧宽度。 Camera.cpp:103-112

## Notes

在Falcor引擎中，虚拟相机的感光平面是基于物理相机模型实现的，但它是一个数学抽象，用于光线追踪和渲染计算。感光平面的面积会影响渲染时的光线分布和曝光，尤其在使用景深（depth of field）等效果时尤为重要。

# 感光平面面积的单位

根据Falcor的代码实现，感光平面的面积确实是平方米。

从我们之前的分析可以看出：

1. 世界空间单位是米：Falcor明确使用米作为世界空间单位
2. 感光平面尺寸计算使用世界空间单位：感光平面的半宽度和半高度都是通过世界空间单位计算的
3. 面积计算：
   1. 感光平面总宽度 = `2 × ulen`（米）
   2. 感光平面总高度 = `2 × vlen`（米）
   3. 感光平面面积 = `4 × ulen × vlen`（平方米）

这在代码中的其他地方也得到了印证，比如三角形面积的计算也使用"世界空间单位" Scene.slang:389 ，而光照计算中的三角形面积注释也明确提到使用"m²"单位 FinalizeIntegration.cs.slang:107-108

## Notes

这种设计确保了整个渲染管线中的物理量都有一致的单位系统，使得光照计算、体积渲染等物理现象能够正确模拟。

# 光圈为0时，可以视为针孔摄像机

基于Falcor5.26代码库的分析，我来回答你的问题：

## 默认光圈半径

在Falcor中，默认的光圈半径是0.0f（场景单位）。 CameraData.slang:64

## 光圈半径为0时的针孔摄像机模型

是的，当光圈半径为0时，摄像机确实可以视为针孔摄像机。Falcor框架实现了两种摄像机模型：

1. 针孔摄像机模型：通过 `computeRayPinhole`方法实现 Camera.slang:39-59
2. 薄透镜摄像机模型：通过 `computeRayThinlens`方法实现，用于模拟景深效果 Camera.slang:81-110

当光圈半径为0时，系统使用针孔摄像机模型，不会产生景深效果。

## 感光平面与CMOS的关系

在这种情况下，感光平面确实可以看成摄像机的CMOS或胶片。Falcor的摄像机模型包含了胶片平面的物理尺寸参数：

* `frameHeight`：胶片平面高度（毫米），默认为24.0mm CameraData.slang:61
* `frameWidth`：胶片平面宽度（毫米），默认约为42.67mm CameraData.slang:62

这些参数模拟了真实摄像机传感器或35mm胶片的物理尺寸，用于计算视场角和透视投影。

## Notes

* Falcor使用的默认胶片尺寸（24mm高度）对应标准35mm胶片的规格
* 针孔摄像机模型假设所有光线都通过一个无限小的孔，因此不存在景深效果，所有距离的物体都是清晰的
* 当需要景深效果时，可以设置非零的光圈半径，系统会自动切换到薄透镜模型
* 光圈半径的单位是场景单位，可以通过 `setApertureRadius`方法进行设置 Camera.h:106-108

# 改变感光平面大小会改变视场角

基于Falcor框架中的针孔摄像机实现，我来回答你关于感光平面大小对视场角影响的问题。

## 视场角计算原理

在Falcor中，视场角是通过焦距和感光平面尺寸计算的。 FalcorMath.h:123-126

公式为：`fovY = 2 * atan(0.5 * frameHeight / focalLength)`

## 感光平面大小的影响

是的，改变感光平面大小会改变视场角。 从代码中可以看到：

1. 感光平面参数：Falcor的摄像机数据结构中定义了感光平面的物理尺寸 CameraData.slang:61-62
2. 像素区域计算：在光功率计算中，感光平面尺寸直接影响像素面积的计算 IncomingLightPowerPass.cpp:94-98
3. 射线方向计算：针孔摄像机的射线方向计算依赖于感光平面的尺寸来确定视场角 Camera.slang:68-78

## 实际应用

在Falcor的摄像机系统中，你可以通过以下方法调整感光平面尺寸：

* `setFrameHeight()` 和 `setFrameWidth()` 方法 Camera.h:82-96

当感光平面变大时，在相同焦距下会获得更大的视场角；反之，感光平面变小则视场角减小。

## Notes

这与真实摄像机的物理原理一致：更大的传感器在相同焦距下能捕获更宽的视野。Falcor的实现准确模拟了这一物理特性，确保了渲染结果的真实性。

# 设置视场角面积

基于Falcor框架中的摄像机实现，我来回答你关于 `setFrameHeight()`和 `setFrameWidth()`方法的问题。

## 方法功能确认

是的，`setFrameHeight()`和 `setFrameWidth()`方法确实是用来设置感光平面（胶片平面）的宽度和高度。 Camera.h:82-96

## 单位说明

单位不是米，而是毫米（mm）。从代码注释和实现中可以清楚看到：

* `frameHeight`：胶片平面高度，单位为毫米，默认值24.0mm对应35mm胶片的高度
* `frameWidth`：胶片平面宽度，单位为毫米，默认值约42.67mm CameraData.slang:61-62

## 实际应用

这些尺寸参数用于视场角计算，在光功率计算等渲染过程中被使用： IncomingLightPowerPass.cpp:94-98

## Notes

* 默认的24mm高度对应标准35mm胶片规格
* 这些物理尺寸参数确保了Falcor能够准确模拟真实摄像机的光学特性
* 单位使用毫米是因为这是摄影和光学领域的标准单位
