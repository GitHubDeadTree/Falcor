# [Falcor] IES Light Profile Loading Error - "Error while loading IES profile"

## ğŸ” Problem Description

I'm encountering an issue when trying to load a custom IES light profile in Falcor 4 using Python scripts. The system throws a warning "Error while loading IES profile" but provides no detailed error information, making it difficult to debug.

## âš ï¸ Error Message

```
(Warning) Error while loading IES profile from 'D:\Campus\KY\Light\Falcor\Falcor\build\windows-vs2022\bin\Debug\temp_ies\center_low_edge_high.ies'.
```

## ğŸ“ Code Implementation

**Python Scene Script (`mytutorial2.pyscene`):**

```python
# Load IES profile using the method from theoretical documentation
print("=== LOADING IES LIGHT PROFILE ===")
try:
    # Load IES profile through SceneBuilder as documented
    sceneBuilder.loadLightProfile(ies_filepath, normalize=True)
    print(f"*** Successfully loaded IES profile: {ies_filepath} ***")
    print("*** Light profile will be automatically applied to emissive materials ***")
except Exception as e:
    print(f"*** Error loading IES profile: {e} ***")
    print("*** Continuing with standard emissive material ***")

# Create emissive material
emissivePlaneMaterial = StandardMaterial('EmissivePlaneMaterial')
emissivePlaneMaterial.emissiveColor = float3(1.0, 1.0, 1.0)  # White light
emissivePlaneMaterial.emissiveFactor = 100.0  # High brightness
emissivePlaneMaterial.doubleSided = True  # Double-sided emission
```

**IES File Content (`temp_ies/center_low_edge_high.ies`):**

```ies
IESNA:LM-63-2002
[TEST] Custom Light Distribution
[TESTLAB] Python Generated
[ISSUEDATE] 2024
[MANUFAC] Falcor Custom
TILT=NONE
1 1000 1.0 9 1 1 2 0.0 0.0 0.0 1.0 1.0 50.0
0.0 22.5 45.0 67.5 90.0 112.5 135.0 157.5 180.0
0.0
0.0 0.0 100.0 100.0 100.0 100.0 1000.0 1000.0 1000.0
```

**Variable Declaration:**

```python
ies_filepath = "temp_ies/center_low_edge_high.ies"
```

## ğŸ”§ What I've Already Tried

### 1. **File Format Validation**

- Ensured IES file follows IESNA:LM-63-2002 standard format
- Verified header syntax with proper keywords (`[TEST]`, `[TESTLAB]`, etc.)
- Checked `TILT=NONE` declaration

### 2. **File Path Testing**

- Confirmed file exists at the specified relative path
- Tested both relative and absolute path references
- Verified file permissions are accessible

### 3. **IES Data Structure**

- Used simplified 9-point vertical angle distribution (0Â° to 180Â°)
- Single horizontal plane (1 horizontal angle at 0Â°)
- Step-wise candela distribution: `0.0 0.0 100.0 100.0 100.0 100.0 1000.0 1000.0 1000.0`

### 4. **Error Handling**

- Added try-catch blocks, but Falcor only shows warning without throwing Python exceptions
- Python exception handling doesn't catch the internal Falcor C++ warning

### 5. **Previous Attempts**

- Initially tried complex 32x32 photometric data (525+ lines) - same error
- Simplified to minimal 9x1 distribution - still fails
- Tested different candela value ranges

## ğŸ¤” Technical Context

- **Engine**: Falcor 4.x
- **Platform**: Windows (VS2022 Debug build)
- **Language**: Python scene scripting
- **API Used**: `sceneBuilder.loadLightProfile(filepath, normalize=True)`

According to Falcor documentation, the light profile system should:

1. Parse IES files using `LightProfile::createFromIesProfile`
2. Bake photometric data into 2D textures for GPU sampling
3. Apply globally to all emissive materials in the scene

## â“ Questions

1. **What are the most common causes of IES loading failures in Falcor?**
2. **Are there specific IES format requirements beyond IESNA:LM-63-2002?**
3. **How can I enable verbose logging to get detailed error information?**
4. **Is there a way to validate IES files before loading them into Falcor?**
5. **Are there working IES file examples I can test with?**
6. **Could the issue be related to file encoding (UTF-8 vs ASCII)?**
7. **Are there minimum/maximum limits on photometric data array sizes?**

## ğŸ¯ Expected Behavior

The IES file should load successfully and create a step-wise light distribution:

- 0Â°-67.5Â°: 0 candela (center dark)
- 67.5Â°-135Â°: 100 candela (medium brightness)
- 135Â°-180Â°: 1000 candela (edge bright)

Any insights or solutions would be greatly appreciated! ğŸ™

**Tags:** `falcor` `ies-lighting` `light-profiles` `python-scripting` `photometrics`




# IES ç¯å…‰åˆ†å¸ƒæ–‡ä»¶åŠ è½½é”™è¯¯é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## é”™è¯¯åŸå› åˆ†æ

åœ¨ Falcor å¼•æ“ä¸­ï¼Œæ‚¨é‡åˆ°çš„ "Error while loading IES profile" é”™è¯¯å¯èƒ½ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®åŸå› å¯¼è‡´ï¼š

1. **IES æ–‡ä»¶æ ¼å¼ä¸ç¬¦åˆè¦æ±‚** ï¼šFalcor å¯¹ IES æ–‡ä»¶æœ‰ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚ï¼ŒåŒ…æ‹¬æ”¯æŒç‰¹å®šçš„ IES æ ‡å‡†æ ¼å¼å’Œæ•°æ®ç»“æ„ã€‚ **LightProfile.cpp:45-54**
2. **æ•°æ®å¤§å°ä¸æ­£ç¡®** ï¼šFalcor æœŸæœ› IES æ–‡ä»¶ä¸­çš„æ•°æ®å…ƒç´ æ•°é‡æ»¡è¶³ç‰¹å®šå…¬å¼ï¼š`headerSize(13) + numHorizontalAngles + numVerticalAngles + (numHorizontalAngles * numVerticalAngles)`ã€‚ **LightProfile.cpp:160-174**
3. **ç¼ºå°‘å¿…è¦çš„ TILT æŒ‡ä»¤** ï¼šIES æ–‡ä»¶å¿…é¡»åŒ…å« `TILT=NONE` è¡Œï¼Œä¸æ”¯æŒå…¶ä»– TILT é€‰é¡¹ã€‚ **LightProfile.cpp:136-143**

## å…·ä½“é—®é¢˜åˆ†æ

æŸ¥çœ‹æ‚¨æä¾›çš„ IES æ–‡ä»¶å†…å®¹ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

1. æ‚¨å£°æ˜äº† 9 ä¸ªå‚ç›´è§’åº¦å’Œ 1 ä¸ªæ°´å¹³è§’åº¦ï¼Œä½†æŒ‰ç…§ Falcor çš„è¦æ±‚ï¼Œæ•°æ®æ€»é‡åº”ä¸ºï¼š13 + 1 + 9 + (1*9) = 32 ä¸ªæ•°å€¼ã€‚ä½†æ‚¨çš„æ–‡ä»¶ä¸­ä¼¼ä¹åªæœ‰çº¦ 17-18 ä¸ªæ•°å€¼ï¼Œä¸ç¬¦åˆ Falcor çš„è§£æè¦æ±‚ã€‚ **LightProfile.cpp:170-174**
2. é”™è¯¯ä¿¡æ¯ä¸è¯¦ç»†æ˜¯å› ä¸º Falcor çš„é”™è¯¯å¤„ç†æœºåˆ¶å°†æ‰€æœ‰ IES è§£æé”™è¯¯ç»Ÿä¸€æŠ¥å‘Šä¸ºåŒä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œæ²¡æœ‰æä¾›å…·ä½“é”™è¯¯åŸå› ã€‚ **LightProfile.cpp:209-217**

## è§£å†³æ–¹æ¡ˆ

1. **ä¿®æ­£ IES æ–‡ä»¶æ ¼å¼** ï¼š

* ç¡®ä¿ç¬¬ä¸€è¡Œæ˜¯æ”¯æŒçš„æ ¼å¼ä¹‹ä¸€ï¼ˆæ‚¨ä½¿ç”¨çš„ `IESNA:LM-63-2002` æ˜¯æ­£ç¡®çš„ï¼‰
* ç¡®è®¤åŒ…å« `TILT=NONE` è¡Œ
* é‡è¦çš„æ˜¯æ•°æ®ç»“æ„ï¼šå¦‚æœæ‚¨æœ‰ 9 ä¸ªå‚ç›´è§’åº¦å’Œ 1 ä¸ªæ°´å¹³è§’åº¦ï¼Œè¯·ç¡®ä¿æœ‰ 32 ä¸ªæ•°å€¼

1. **ä¿®æ”¹ IES æ–‡ä»¶ç¤ºä¾‹** ï¼šä»¥ä¸‹æ˜¯ä¿®æ­£åçš„æ ¼å¼ç¤ºä¾‹ï¼ˆæ³¨æ„æ•°æ®é‡ï¼‰ï¼š

```
   IESNA:LM-63-2002
   [TEST] Custom Light Distribution
   [TESTLAB] Python Generated
   [ISSUEDATE] 2024
   [MANUFAC] Falcor Custom
   TILT=NONE
   1 1000 1.0 9 1 1 2 0.0 0.0 0.0 1.0 1.0 50.0
   0.0 22.5 45.0 67.5 90.0 112.5 135.0 157.5 180.0
   0.0
   0.0 0.0 100.0 100.0 100.0 100.0 1000.0 1000.0 1000.0
```

1. **æ£€æŸ¥æ–‡ä»¶ç¼–ç ** ï¼šç¡®ä¿æ–‡ä»¶ä¸ºçº¯ ASCII ç¼–ç æˆ– UTF-8 æ—  BOMï¼Œå› ä¸º Falcor çš„è§£æä¾èµ–äºæ ‡å‡† C å­—ç¬¦ä¸²å‡½æ•°ã€‚ **LightProfile.cpp:100-107**
2. **å¯ç”¨æ›´è¯¦ç»†æ—¥å¿—** ï¼šè™½ç„¶ Falcor é»˜è®¤ä¸æä¾›è¯¦ç»†çš„ IES è§£æé”™è¯¯ä¿¡æ¯ï¼Œä½†æ‚¨å¯ä»¥å°è¯•åœ¨å¼€å‘ç¯å¢ƒä¸­è®¾ç½®æ–­ç‚¹æ¥æŸ¥çœ‹ `parseIesFile` å‡½æ•°çš„è¿”å›å€¼ï¼Œäº†è§£å…·ä½“é”™è¯¯ç±»å‹ã€‚ **LightProfile.cpp:90-97**

## å…³äºæ‚¨çš„å…¶ä»–é—®é¢˜

1. **æ¨èçš„æµ‹è¯• IES æ–‡ä»¶** ï¼šé—æ†¾çš„æ˜¯ï¼ŒFalcor ä»£ç ä¸­æ²¡æœ‰ç›´æ¥æä¾›ç¤ºä¾‹ IES æ–‡ä»¶ã€‚æˆ‘å»ºè®®å°è¯•ä½¿ç”¨ä¸€äº›æ ‡å‡†çš„ IES å·¥å…·ç”Ÿæˆç¬¦åˆè§„èŒƒçš„æ–‡ä»¶ï¼Œå¦‚ DIALux æˆ– Photometric Toolboxã€‚
2. **å…‰åº¦æ•°ç»„é™åˆ¶** ï¼šæ ¹æ®ä»£ç ï¼ŒFalcor è¦æ±‚è‡³å°‘ 16 ä¸ªæ•°å€¼æ•°æ®ï¼Œå¯¹æœ€å¤§å€¼æ²¡æœ‰æ˜ç¡®é™åˆ¶ï¼Œä½†æ•°é‡å¿…é¡»ç²¾ç¡®åŒ¹é…å…¬å¼ã€‚ **LightProfile.cpp:160-163**
3. **éªŒè¯ IES æ–‡ä»¶** ï¼šåœ¨å¯¼å…¥ Falcor å‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸“ä¸šçš„ IES æŸ¥çœ‹å™¨ï¼ˆå¦‚ IES Viewerï¼‰æ¥éªŒè¯æ–‡ä»¶æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚

## æ³¨æ„äº‹é¡¹

* Falcor çš„ IES è§£æå™¨ç›¸å¯¹ç®€å•ï¼Œå¯èƒ½ä¸æ”¯æŒæ‰€æœ‰å¤æ‚çš„ IES æ–‡ä»¶æ ¼å¼å˜ä½“
* æ•°æ®é‡çš„è®¡ç®—å…¬å¼æ˜¯å…³é”®ï¼Œå¿…é¡»ç²¾ç¡®åŒ¹é…
* å¦‚æœä¿®æ”¹åä»æœ‰é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨æ›´ç®€å•çš„ IES æ–‡ä»¶è¿›è¡Œæµ‹è¯•ï¼Œå†é€æ­¥å¤æ‚åŒ–

å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¸®åŠ©æ‚¨è§£å†³ IES ç¯å…‰åˆ†å¸ƒæ–‡ä»¶åŠ è½½çš„é—®é¢˜ï¼

Notes:

* è§£å†³æ–¹æ¡ˆåŸºäº Falcor ä»£ç åº“ä¸­çš„ LightProfile.cpp å®ç°
* é”™è¯¯å¤„ç†ä¸­ç¼ºå°‘è¯¦ç»†ä¿¡æ¯æ˜¯è®¾è®¡é™åˆ¶ï¼Œä¸æ˜¯ç”¨æˆ·çš„å®ç°é—®é¢˜
* æ•°æ®é‡è¦æ±‚æ˜¯å¯¼è‡´é—®é¢˜çš„æœ€å¯èƒ½åŸå› 
