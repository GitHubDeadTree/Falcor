# CIR过滤参数调整报告

## 概述
根据用户需求，对CPU端CIR（Channel Impulse Response）数据过滤的默认参数进行了调整，提高过滤的精确度和适用性。

## 修改详情

### 参数调整内容
1. **最小功率阈值调整**
   - 原值：`0.0f` (watts)
   - 新值：`1e-14f` (0.00000000000001 watts)
   - 意义：设置更精确的最小功率阈值，过滤掉微弱的噪声信号

2. **最大路径长度调整**
   - 原值：`1000.0f` (meters)
   - 新值：`80.0f` (meters)
   - 意义：限制路径长度在更合理的室内VLC通信范围内

### 技术实现

#### 修改文件
- `Source/Falcor/Rendering/Utils/PixelStats.h`

#### 修改位置
```cpp
// 原始参数
float mCIRMaxPathLength = 1000.0f;     // Maximum path length for CIR filtering (meters)
float mCIRMinEmittedPower = 0.0f;      // Minimum emitted power for CIR filtering (watts)

// 调整后参数
float mCIRMaxPathLength = 80.0f;       // Maximum path length for CIR filtering (meters)
float mCIRMinEmittedPower = 1e-14f;    // Minimum emitted power for CIR filtering (watts)
```

## 参数选择的理由

### 最小功率设置为1e-14W
1. **物理意义**：
   - 对应于非常微弱但仍然可检测的光信号
   - 高于典型的噪声水平，能有效过滤噪声
   - 符合实际VLC系统的接收器灵敏度

2. **数值特点**：
   - 使用科学计数法表示，避免浮点精度问题
   - 比原来的0.0f更严格，但仍然允许微弱有效信号通过

### 最大路径长度设置为80m
1. **应用场景**：
   - 适合室内VLC通信环境
   - 覆盖大型室内空间（如教室、办公区域）
   - 避免不合理的超长路径（如原来的1000m）

2. **性能优化**：
   - 减少无效数据的收集和处理
   - 提高数据质量和相关性
   - 降低计算和存储开销

## 影响分析

### 正面影响
1. **数据质量提升**：
   - 过滤掉微弱噪声信号
   - 专注于有意义的通信路径
   - 提高CIR数据的信噪比

2. **性能优化**：
   - 减少无效数据处理
   - 降低内存使用
   - 提高处理速度

3. **应用适配性**：
   - 更符合实际VLC应用场景
   - 便于后续分析和处理

### 潜在影响
1. **数据覆盖范围**：
   - 可能会过滤掉一些边缘情况的有效数据
   - 超过80m的长距离路径将被排除

2. **参数调整**：
   - 用户可通过UI界面实时调整这些参数
   - 支持根据具体应用需求进行定制

## 使用指南

### 用户界面控制
用户可以通过Falcor界面的"CIR Filtering"部分调整参数：
- `Min Emitted Power`: 可调整最小功率阈值
- `Max Path Length`: 可调整最大路径长度
- `Filtering Enabled`: 可开启/关闭过滤功能

### 推荐设置
根据不同应用场景的推荐参数：

1. **室内VLC通信**（默认）：
   - 最小功率：1e-14W
   - 最大路径：80m

2. **精密测量**：
   - 最小功率：1e-15W（更敏感）
   - 最大路径：50m（更严格）

3. **广覆盖场景**：
   - 最小功率：1e-13W（降低敏感度）
   - 最大路径：150m（扩大范围）

## 兼容性说明

### 向后兼容
- 现有的CIR数据格式保持不变
- UI界面功能完全兼容
- 数据导出格式无变化

### 配置保存
- 参数修改会立即生效
- 用户可随时通过UI重新调整
- 支持实时预览过滤效果

## 总结

此次参数调整优化了CIR数据过滤的默认配置，使其更适合实际的VLC通信应用场景。调整后的参数在保证数据质量的同时，提供了更好的性能表现。用户仍可根据具体需求通过UI界面进行个性化调整。

## 修改时间
2024年12月31日
